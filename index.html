<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>War Clicker</title>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --button-color: #007bff;
            --panel-color: #f0f0f0;
            --combo-color: #ff5722;
        }

        body.dark {
            --bg-color: #1e1e1e;
            --text-color: #ffffff;
            --button-color: #1a73e8;
            --panel-color: #2d2d2d;
            --combo-color: #ff7043;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            text-align: center;
            margin: 0;
            padding: 10px;
            transition: all 0.3s;
            user-select: none;
        }

        #click-area {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            background-image: url('https://q-xx.bstatic.com/xdata/images/hotel/max500/215500382.jpg?k=bfab20a750261abbb7ea08a9886b1eb9e0a7795acd9a3aefca9830a56cccf26b&s=100x100');
            background-size: cover;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid var(--button-color);
            position: relative;
        }

        .stats {
            margin: 10px 0;
            font-size: 18px;
        }

        .nav {
            display: flex;
            justify-content: space-around;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--panel-color);
            padding: 10px;
        }

        .nav-button {
            padding: 10px 15px;
            background-color: var(--button-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--panel-color);
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 400px;
            z-index: 100;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            max-height: 80vh;
            overflow-y: auto;
        }

        .upgrade {
            margin: 10px 0;
            padding: 10px;
            background-color: var(--bg-color);
            border-radius: 5px;
            cursor: pointer;
            border: 1px solid #ddd;
        }

        .upgrade.unavailable {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .close-button {
            position: absolute;
            top: 5px;
            right: 10px;
            cursor: pointer;
            font-size: 20px;
        }

        .combo-display {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--combo-color);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .critical-hit {
            animation: criticalAnimation 0.5s;
        }

        @keyframes criticalAnimation {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="stats">
        <div>Баланс: <span id="balance">0</span></div>
        <div>Урон за клик: <span id="damage-per-click">1</span></div>
        <div>Уровень: <span id="level">1</span> (<span id="current-damage">0</span>/<span id="required-damage">500</span>)</div>
        <div>Всего нанесено урона: <span id="total-damage">0</span></div>
    </div>

    <div id="click-area">
        <div class="combo-display" id="combo-display">x1.0</div>
    </div>

    <div class="nav">
        <button class="nav-button" id="shop-button">Магазин</button>
        <button class="nav-button" id="boosts-button">Усиления</button>
        <button class="nav-button" id="achievements-button">Достижения</button>
    </div>

    <div id="shop-menu" class="menu">
        <span class="close-button" id="close-shop">×</span>
        <h2>Магазин</h2>
        <div id="upgrades-container"></div>
    </div>

    <div id="boost-menu" class="menu">
        <span class="close-button" id="close-boosts">×</span>
        <h2>Усиления</h2>
        <div id="boosts-container"></div>
    </div>

    <div id="achievements-menu" class="menu">
        <span class="close-button" id="close-achievements">×</span>
        <h2>Достижения</h2>
        <div id="achievements-container"></div>
    </div>
<script>
    const game = {
        balance: 0,
        totalDamage: 0,
        damagePerClick: 1,
        baseDamage: 1,
        dps: 0,
        level: 1,
        experience: 0,
        requiredExperience: 500,
        combo: 1,
        maxCombo: 3,
        activeBoosts: [],
        maxActiveBoosts: 2,
        critChance: 0,
        critMultiplier: 2,
        autoClicker: 0,
        globalMultiplier: 1,
        comboTimeout: null,
        comboTimeoutDuration: 2000,
        clickTimes: [],
        upgrades: {
            knife: { id: 'knife', name: 'Нож', bought: false, cost: 50, damage: 1, type: 'melee', next: 'axe' },
            axe: { id: 'axe', name: 'Топор', bought: false, cost: 150, damage: 3, type: 'melee', next: 'sword' },
            sword: { id: 'sword', name: 'Меч', bought: false, cost: 300, damage: 5, type: 'melee', next: 'chainsaw' },
            chainsaw: { id: 'chainsaw', name: 'Бензопила', bought: false, cost: 700, damage: 10, type: 'melee', next: 'lightsaber' },
            lightsaber: { id: 'lightsaber', name: 'Лазерный меч', bought: false, cost: 1500, damage: 20, type: 'melee' },
            pistol: { id: 'pistol', name: 'Пистолет', bought: false, cost: 100, damage: 2, type: 'ranged', next: 'rifle' },
            rifle: { id: 'rifle', name: 'Винтовка', bought: false, cost: 250, damage: 5, type: 'ranged', next: 'sniper' },
            sniper: { id: 'sniper', name: 'Снайперка', bought: false, cost: 600, damage: 12, type: 'ranged', critChance: 5, critMultiplier: 3, next: 'grenadeLauncher' },
            grenadeLauncher: { id: 'grenadeLauncher', name: 'Гранатомёт', bought: false, cost: 1200, damage: 25, type: 'ranged', aoe: true, next: 'plasmaGun' },
            plasmaGun: { id: 'plasmaGun', name: 'Плазменная пушка', bought: false, cost: 2500, damage: 50, type: 'ranged' }
        },
        boosts: {
            emperor: { 
                id: 'emperor',
                name: "За императора!", 
                description: "+2 урона за клик на 1 минуту", 
                cost: 0, 
                cooldown: 24 * 60 * 60 * 1000,
                lastUsed: 0,
                effect: function() { game.baseDamage += 2; },
                revert: function() { game.baseDamage -= 2; },
                duration: 60000
            },
            mobilization: { 
                id: 'mobilization',
                name: "Тотальная мобилизация", 
                description: "Удваивает DPS на 30 сек", 
                cost: 0, 
                cooldown: 60 * 60 * 1000,
                lastUsed: 0,
                effect: function() { game.dps *= 2; },
                revert: function() { game.dps /= 2; },
                duration: 30000
            },
            reconnaissance: {
                id: 'reconnaissance',
                name: "Разведка",
                description: "+50% урона на 20 кликов",
                cost: 0,
                cooldown: 45 * 60 * 1000,
                lastUsed: 0,
                effect: function() { game.globalMultiplier *= 1.5; },
                revert: function() { game.globalMultiplier /= 1.5; },
                clicksLeft: 20
            }
        },
        stats: {
            totalClicks: 0,
            critHits: 0
        }
    };

    function initGame() {
        loadGame();
        setupEventListeners();
        calculateDamage();
        startDPS();
        updateUI();
    }

    function setupEventListeners() {
        document.getElementById('click-area').addEventListener('click', handleClick);
        document.getElementById('shop-button').addEventListener('click', () => {
            openMenu('shop');
            renderShop();
        });
        document.getElementById('boosts-button').addEventListener('click', () => {
            openMenu('boosts');
            renderBoosts();
        });
        document.getElementById('achievements-button').addEventListener('click', () => {
            openMenu('achievements');
        });
        document.getElementById('close-shop').addEventListener('click', () => closeMenu('shop'));
        document.getElementById('close-boosts').addEventListener('click', () => closeMenu('boosts'));
        document.getElementById('close-achievements').addEventListener('click', () => closeMenu('achievements'));
    }

    function handleClick() {
        game.stats.totalClicks++;
        const now = Date.now();
        game.clickTimes.push(now);
        game.clickTimes = game.clickTimes.filter(time => now - time < 2000);
        
        if (game.clickTimes.length >= 15) {
            game.combo = Math.min(game.maxCombo, game.combo + 0.1);
            showCombo();
        }
        
        if (game.comboTimeout) clearTimeout(game.comboTimeout);
        game.comboTimeout = setTimeout(() => {
            game.combo = 1;
            document.getElementById('combo-display').style.opacity = '0';
        }, game.comboTimeoutDuration);
        
        let damage = game.damagePerClick * game.combo;
        
        if (Math.random() * 100 < game.critChance) {
            damage *= game.critMultiplier;
            game.stats.critHits++;
            document.getElementById('click-area').classList.add('critical-hit');
            setTimeout(() => {
                document.getElementById('click-area').classList.remove('critical-hit');
            }, 500);
        }
        
        damage = Math.floor(damage);
        game.balance += damage;
        game.totalDamage += damage;
        game.experience += damage;
        
        checkLevelUp();
        updateUI();
        saveGame();
    }

    function showCombo() {
        const comboDisplay = document.getElementById('combo-display');
        comboDisplay.textContent = `x${game.combo.toFixed(1)}`;
        comboDisplay.style.opacity = '1';
    }

    function calculateDamage() {
        game.damagePerClick = game.baseDamage;
        game.critChance = 0;
        
        for (const upgrade of Object.values(game.upgrades)) {
            if (upgrade.bought) {
                if (upgrade.type === 'melee' || upgrade.type === 'ranged') {
                    game.damagePerClick += upgrade.damage;
                }
                if (upgrade.critChance) {
                    game.critChance += upgrade.critChance;
                }
                if (upgrade.critMultiplier) {
                    game.critMultiplier = Math.max(game.critMultiplier, upgrade.critMultiplier);
                }
            }
        }
        
        game.damagePerClick = Math.floor(game.damagePerClick * game.globalMultiplier);
    }

    function checkLevelUp() {
        while (game.experience >= game.requiredExperience) {
            game.experience -= game.requiredExperience;
            game.level++;
            game.requiredExperience = Math.floor(game.requiredExperience * 1.5);
            
            for (const upgrade of Object.values(game.upgrades)) {
                upgrade.cost = Math.floor(upgrade.cost * 1.2);
            }
        }
    }

    function updateUI() {
        document.getElementById('balance').textContent = game.balance;
        document.getElementById('damage-per-click').textContent = game.damagePerClick;
        document.getElementById('total-damage').textContent = game.totalDamage;
        document.getElementById('level').textContent = game.level;
        document.getElementById('current-damage').textContent = game.experience;
        document.getElementById('required-damage').textContent = game.requiredExperience;
    }

    function startDPS() {
        setInterval(() => {
            if (game.dps > 0) {
                game.balance += game.dps;
                game.totalDamage += game.dps;
                game.experience += game.dps;
                checkLevelUp();
                updateUI();
                saveGame();
            }
        }, 1000);
    }

    function renderShop() {
        const container = document.getElementById('upgrades-container');
        container.innerHTML = '';
        
        let availableUpgrades = [];
        
        for (const upgrade of Object.values(game.upgrades)) {
            if (!upgrade.bought) {
                if (!upgrade.next || game.upgrades[upgrade.next]?.bought === false) {
                    availableUpgrades.push(upgrade);
                }
            }
        }
        
        if (availableUpgrades.length === 0) {
            container.innerHTML = '<p>Все улучшения куплены!</p>';
            return;
        }
        
        for (const upgrade of availableUpgrades) {
            const canBuy = game.balance >= upgrade.cost;
            
            const upgradeElement = document.createElement('div');
            upgradeElement.className = `upgrade ${canBuy ? '' : 'unavailable'}`;
            upgradeElement.innerHTML = `
                <strong>${upgrade.name}</strong><br>
                +${upgrade.damage} урон<br>
                Цена: ${upgrade.cost}
            `;
            
            if (canBuy) {
                upgradeElement.addEventListener('click', () => buyUpgrade(upgrade.id));
            }
            
            container.appendChild(upgradeElement);
        }
    }

    function buyUpgrade(id) {
        const upgrade = game.upgrades[id];
        
        if (!upgrade.bought && game.balance >= upgrade.cost) {
            game.balance -= upgrade.cost;
            upgrade.bought = true;
            
            calculateDamage();
            updateUI();
            renderShop();
            saveGame();
        }
    }

    function renderBoosts() {
        const container = document.getElementById('boosts-container');
        container.innerHTML = '';
        
        for (const boost of Object.values(game.boosts)) {
            const now = Date.now();
            const remainingCooldown = Math.max(0, boost.cooldown - (now - boost.lastUsed));
            const minutes = Math.ceil(remainingCooldown / (60 * 1000));
            
            const isActive = game.activeBoosts.some(b => b.id === boost.id);
            const canActivate = remainingCooldown <= 0 && !isActive && 
                              game.activeBoosts.length < game.maxActiveBoosts;
            
            const boostElement = document.createElement('div');
            boostElement.className = `upgrade ${canActivate ? '' : 'unavailable'}`;
            boostElement.style.opacity = canActivate ? '1' : '0.7';
            boostElement.innerHTML = `
                <strong>${boost.name}</strong><br>
                ${boost.description}<br>
                ${isActive ? 'АКТИВНО' : 
                  remainingCooldown > 0 ? `Доступно через: ${minutes} мин` : 'Готово'}
            `;
            
            if (canActivate) {
                boostElement.addEventListener('click', () => activateBoost(boost.id));
            }
            
            container.appendChild(boostElement);
        }
    }

    function activateBoost(id) {
        const boost = game.boosts[id];
        const now = Date.now();
        
        boost.lastUsed = now;
        boost.effect();
        
        game.activeBoosts.push({
            id: boost.id,
            endTime: now + boost.duration
        });
        
        setTimeout(() => {
            boost.revert();
            game.activeBoosts = game.activeBoosts.filter(b => b.id !== boost.id);
            renderBoosts();
            saveGame();
        }, boost.duration);
        
        if (id === 'reconnaissance') {
            const originalClick = handleClick;
            let clicks = 0;
            const reconClickHandler = function() {
                clicks++;
                if (clicks >= 20) {
                    boost.revert();
                    game.activeBoosts = game.activeBoosts.filter(b => b.id !== boost.id);
                    document.getElementById('click-area').removeEventListener('click', reconClickHandler);
                    handleClick = originalClick;
                }
                originalClick.apply(this, arguments);
            };
            
            handleClick = reconClickHandler;
        }
        
        renderBoosts();
        saveGame();
    }

    function openMenu(type) {
        if (type === 'shop') document.getElementById('shop-menu').style.display = 'block';
        if (type === 'boosts') document.getElementById('boost-menu').style.display = 'block';
        if (type === 'achievements') document.getElementById('achievements-menu').style.display = 'block';
    }

    function closeMenu(type) {
        if (type === 'shop') document.getElementById('shop-menu').style.display = 'none';
        if (type === 'boosts') document.getElementById('boost-menu').style.display = 'none';
        if (type === 'achievements') document.getElementById('achievements-menu').style.display = 'none';
    }

    function saveGame() {
        localStorage.setItem('warClickerSave', JSON.stringify({
            balance: game.balance,
            totalDamage: game.totalDamage,
            damagePerClick: game.damagePerClick,
            baseDamage: game.baseDamage,
            dps: game.dps,
            level: game.level,
            experience: game.experience,
            requiredExperience: game.requiredExperience,
            combo: game.combo,
            critChance: game.critChance,
            critMultiplier: game.critMultiplier,
            autoClicker: game.autoClicker,
            globalMultiplier: game.globalMultiplier,
            stats: game.stats,
            upgrades: game.upgrades,
            activeBoosts: game.activeBoosts,
            boosts: Object.fromEntries(Object.entries(game.boosts).map(([k,v]) => [k, {lastUsed: v.lastUsed}])
        }));
    }

    function loadGame() {
        const savedData = localStorage.getItem('warClickerSave');
        if (savedData) {
            const savedGame = JSON.parse(savedData);
            Object.assign(game, savedGame);
            
            const now = Date.now();
            game.activeBoosts = savedGame.activeBoosts.filter(boost => {
                if (boost.endTime > now) {
                    const remainingTime = boost.endTime - now;
                    setTimeout(() => {
                        if (game.boosts[boost.id]) {
                            game.boosts[boost.id].revert();
                        }
                        game.activeBoosts = game.activeBoosts.filter(b => b.id !== boost.id);
                        renderBoosts();
                    }, remainingTime);
                    return true;
                }
                return false;
            });
            
            calculateDamage();
        }
    }

    setInterval(saveGame, 30000);
    window.addEventListener('load', initGame);
</script>
</body>
</html>
